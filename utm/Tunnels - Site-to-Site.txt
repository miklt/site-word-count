https://docs.blockbit.com/display/RC/Tunnels+-+Site-to-Site
1767
['', 'Tunnels - Site-to-Site', '']
['', 'O método do serviço VPN IPSEC Site-to-Site\xa0visa gerenciar múltiplos túneis virtuais de redes privadas e provê uma conexão do tipo túnel site-to-site (LAN to LAN);VPN IPSec - Topologia Site-to-SiteAo adicionar um túnel, caso o tipo selecionado tenha sido\xa0“Site-to-Site” ao clicar em editar\xa0[], a tela abaixo será exibida:VPN IPSEC Settings – Site-to-siteÀ seguir, vamos analisar como configurar um túnel "Site-to-Site".GeneralAbaixo analisaremos cada opção disponível no painel general:VPN IPSEC - GeneralDescription:\xa0Campo onde é determinada a descrição da VPN, que está sendo configurada;IKE version:\xa0O IKE – Internet Key Exchange é o protocolo usado para estabelecer uma associação de segurança (SA) na suíte de protocolos IPSec. O IKE se baseia no protocolo Oakley e ISAKMP, utiliza-se de uma chave de autenticação PSK ou certificados X509 e uma troca de chaves “Diffie Hellman”;', '\xa0No\xa0Blockbit UTM utilizamos a chave do tipo: “PSK (Chave pré compartilhada)”, e a troca de chaves “Diffie Hellman”. O sistema suporta as versões IKEV1 e IKEV2.', '', 'É essencial para o funcionamento correto da VPN que todas as devices desta mesma comunidade de servidores estejam configuradas para a mesma versão IKE.', 'Local host:\xa0Endereço de comunicação do ponto VPN LOCAL para estabelecer o túnel. Deve ser identificado por: “Endereço IP” ou “Hostname(FQDN)”;Remote host:\xa0Endereço de comunicação do ponto VPN REMOTO para estabelecer o túnel. Deve ser identificado por: “Endereço IP” ou “Hostname (FQDN)”. A opção Dynamic é usado quando o link de internet e de IP é do tipo dinâmico;Local ID:\xa0Método de identificação da ponta VPN Local, utilizado também como método de autenticação do IKE na fase 1. Defina e configure a identificação entre os tipos: “Endereço IP”, “Hostname (FQDN)” ou “email@dominio”;Remote ID:\xa0Método de identificação da ponta VPN Remota, utilizado também como método de autenticação do IKE na fase 1. Defina e configure a identificação entre os tipos: “Endereço IP”, “Hostname (FQDN)” ou “email@dominio”.\xa0A opção Dynamic é usado quando o link de internet e de IP é do tipo dinâmico;Tunnel initialization:\xa0Determina como será a inicialização do túnel, as opções disponíveis são:Automatic: Adiciona e inicializa o Túnel;Wait: Adiciona e não inicializa o Túnel. Aguarda requisição de demanda (tráfego) por parte da outra ponta VPN;On demand: Inicializa e levanta o Túnel somente sob demanda, ou seja, quando houver tráfego de qualquer das ponta VPN.Exchange Mode:\xa0Método de negociação da chave IKE(SA) versão 1:Main Mode: Modo principal de negociação das chaves IKE (Criptografia e autenticação) Opera a troca de informações em 6 pacotes;Aggressive Mode: Modo agressivo de negociação das chaves IKE (Criptografia e autenticação) Opera a troca de informações em 3 pacotes.', 'O IKE v2 opera nativamente o “Exchange Mode” no padrão: [Main Mode].', 'Authentication Method:\xa0Determina o método de autenticação que será utilizado na VPN, as opções possíveis são:Shared key PSK: É uma chave pré-compartilhada (Pre-Shared Key ou PSK) é um segredo compartilhado anteriormente entre as duas partes usando algum canal seguro antes de ser utilizado. Tais sistemas quase sempre usam algoritmos criptográficos de chave simétrica. Essa chave é utilizada no processo de autenticação pelo protocolo IKE. O administrador deve definir essa chave e configurar em ambos os pontos VPN;RSA Key: Chave RSA é composta por um algoritmo usado em criptografia assimétrica, tecnologia de segurança que utiliza um par de chaves (chave pública e chave privada), aplicando um componente diferente do par em diferentes fases do algoritmo. Toda mensagem cifrada usando uma chave pública só pode ser decifrada usando a respectiva chave privada. As Chaves RSA publicas devem ser “trocadas” entre ambos os “sites VPN”;', 'Caso use o\xa0Authentication Method\xa0do tipo\xa0RSA Key, o ID Local não pode ser reutilizado em outra VPN.', 'Shared Key:\xa0Caso a opção “Shared Key” esteja selecionada em “Authentication Method”, este campo estará disponível e é neste mesmo que o administrador pode definir a chave que será utilizada para configurar ambos os pontos da VPN. É essencial para o funcionamento correto da VPN que este campo seja igual entre todas as devices da comunidade de servidores;Local RSA Key:\xa0Caso a opção “RSA Key” esteja selecionada em “Authentication Method”, este campo estará disponível e é neste mesmo que a chave local será criada, ela precisará ser inserida no campo “Remote RSA Key” de outra appliance para estabelecer uma conexão;Remote RSA Key:\xa0Caso a opção “RSA Key” esteja selecionada em “Authentication Method”, este campo estará disponível e é neste mesmo que a Local RSA KEY deve ser adicionada de modo a estabelecer uma conexão.Abaixo analisaremos cada opção disponível no painel network:NetworkO painel Network\xa0é composto pelos seguintes recursos:VPN IPSEC - NetworkIP Version:\xa0Informar a versão da rede que será declarada, que poder ser do tipo IPv4 ou IPv6;Local networks:\xa0Declaração dos endereços IP de rede/sub-rede local “não válida” do site VPN LOCAL. Ex.: “172.16.10.0/24”;Remote networks:\xa0Declaração dos endereços IP de rede/sub-rede local “não válida” do site VPN Remoto. Ex.: “10.16.10.0/24”.', 'As “Classes de rede” não válida dos sites VPN [Local/Remoto], requer que estejam obrigatoriamente em uma “Classe de rede broadcast diferente”.', '', 'Redes VPN utilizando IKEv1, não suportam declaração de “Múltiplas redes”.', 'Abaixo analisaremos cada opção disponível no painel Cryptography:CryptographyO painel Cryptography\xa0é composto pelos seguintes recursos:VPN IPSEC - CryptographyPhase 1 (IKE):\xa0Baseado no protocolo ISAKMP (IKE/SA): define o agrupamento dos algoritmos e especificações técnicas de autenticação da Fase (IKE/SA) para o dispositivo VPN utilizado para estabelecer o túnel VPN:Cryptographic Algorithms;Authentication Algorithm;DH Group (Diffie Hellman).Phase 2 (ESP):\xa0O protocolo ESP fornece confidencialidade de dados (criptografia) e autenticação (integridade de dados e autenticação da origem dos dados). O ESP se baseia na utilização dos algoritmos AH (Authentication Header) e ESP (Encapsulating Security Payload).\xa0Baseado nos protocolos AH e ESP (ESP/AS): Define o agrupamento dos algoritmos e especificações técnicas de autenticação da Fase (IPSEC/SA) para o dispositivo VPN utilizado para estabelecer o túnel VPN:Cryptographic Algorithms;Authentication Algorithm;PFS Group.Abaixo analisaremos cada opção disponível no painel Advanced:AdvancedO painel Advanced\xa0é composto pelos seguintes recursos:VPN IPSEC - Advanced\xa0IKE lifetime:\xa0Determina o tempo de vida que o protocolo (IKE ou IPSEC dependendo da fase) irá aguardar para renegociar a SA (Security Association), que especifica os algoritmos a serem utilizados, as chaves criptográficas, e os tempos de vida destas chaves. O tempo de vida deve ser determinado em segundos.\xa0O protocolo IKE é o autenticador e o negociador do IPSec;Key lifetime:\xa0Determina o tempo de validade da chave de negociação bem-sucedida. O tempo de vida deve ser determinado em segundos;Keying tries:\xa0Este é o número de vezes que os pontos VPN vão renegociar o túnel ou tentar reautenticação (re-key) depois que a chave expirar. Determina o número de tentativas para estabelecer a renegociação em cada fase de negociação do IKE/IPSec;Rekey Margin:\xa0Determina quanto tempo antes da conexão expirar os pontos VPN e inicializar a renegociação das chaves do túnel. Tempo mínimo = 5 minutos. Tempo máximo = 9 minutos. Este campo é determinado em segundos;DPD Action:\xa0O item DPD (Dead peer detection action) controla o uso do protocolo de detecção dos pontos de VPN perdidos. Onde as mensagens de notificação do protocolo IKE v1 e IKE v2 são enviados periodicamente a fim de verificar se os pontos IPSec estão respondendo, ou estão perdidos;\xa0A seleção de qualquer valor “clear”, “hold” e “reiniciar”, ativa o serviço DPD e determina a ação a ser executada em um tempo limite:A ação “Clear” fecha, ou encerra a conexão sem tomadas de medidas prévias;A ação “Hold” configura uma política estratégica que captura o tráfego e tenta renegociar a conexão sob demanda;A ação “Restart” inicia imediatamente uma tentativa de renegociação da conexão;O padrão é “None” ou nenhuma, desativa o envio automático das mensagens DPD.DPD Delay:\xa0Define o intervalo de tempo ou período, que as mensagens de troca IKE v1 e IKE v2 informativas são enviadas para os pontos VPN. Tempo padrão 30 segundos. Este campo é determinado em segundos;DPD timeout:\xa0Define o intervalo de tempo limite para o envio das mensagens, para o IKE v1 após todas as conexões para um ponto VPN serem perdidas em caso de inatividade. Tempo padrão 150 segundos;', 'Para o IKE v2 o tempo limite de retransmissão “DPD delay” sempre se aplica.\xa0Este campo é determinado em segundos.', 'Re-Auth:\xa0Esta caixa de checagem permite habilitar o processo de reautenticação. Este recurso tem como função renegociar as chaves IKE e verificar a validade das credenciais, caso esta caixa de seleção esteja desabilitada, a conexão continuará ativa mesmo caso o certificado tenha expirado;Fragmentation:\xa0Ao habilitar esta caixa de checagem, mensagens IKEv2 muito extensas são fragmentadas em um conjunto de mensagens menores, que por sua vez são encriptadas individualmente. A função deste recurso é permitir que mensagens IKEv2 sejam transportadas por dispositivos de rede que não permitem a transporte de fragmentos de IP;Compression:\xa0Esta caixa de checagem habilita o uso do protocolo IPComp para a compressão do conteúdo dos pacotes de IP em conjunto com a criptografia IPsec. Caso ambos os hosts possuam recursos o suficiente para efetuar o processo de compactação e caso o link utilizado não esteja apresentando alguma instabilidade, a comunicações entre os nós é melhorada;', 'Pacotes pequenos (por exemplo: ICMP com tamanho default), não sofrem compressão. A comunicação é feita através de um túnel IPIP, sendo necessário efetuar a liberação do objeto de serviço padrão: IPIP-ENCAPSULATION (protocolo IPv4 Encapsulation) entre os peers através de uma política de Zone-Protection.Para mais informações a respeito da compressão cheque o RFC 3173.Para mais dados de encapsulamento IP dentro de IP vide o RFC 2003.Para mais informações a respeito de fragmentação, consulte esta\xa0página.', 'NAT-T:\xa0Habilite o item NAT-T (NAT Transversal) caso um dos sites VPN estiver atrás de um servidor de tradução de endereços (NAT) “Firewall”. Este recurso habilitado garante o encapsulamento UDP (UDP/4500) e que os pacotes trafegados serão traduzidos corretamente.', '\xa0Habilitação obrigatória somente para o IKE v1.', 'Após finalizar as configurações adequadas, clique em [] para salvar as configurações, caso contrário, clique em [] para voltar.', 'Ao finalizar, é possível\xa0validar as configurações da sua VPN\xa0através dos seguintes meios:Pela aba\xa0Live Sessions - VPN;Em\xa0Security Events - VPN;Usando os comandos de CLI abaixo:debug-vpn -t ipsec;show-vpn-conn;show-vpn-info.Para mais informações, sobre cada um destes procedimentos consulte a página de\xa0Troubleshooting das VPNs.', '', '']
