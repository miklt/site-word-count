https://docs.blockbit.com/display/RC/Tunnels+-+Star
1898
['', 'Tunnels - Star', '']
['', 'Na topologia Star, todos os devices estabelecem comunicação com um HUB (normalmente é a Matriz da empresa), e esta permite a comunicação entre os devices, porém, de forma controlada. A seguir, segue um exemplo:VPN IPSec - Topologia StarAo adicionar um túnel, caso o tipo selecionado tenha sido\xa0“Star” ao editá-lo\xa0[], a tela abaixo será exibida:VPN IPSEC Settings – StarSuporte à AD-VPN O Auto-Discovery VPN é uma expansão do protocolo IPsec, que aperfeiçoa a comunicação entre os sites em um túnel VPN, ele permite gerar túneis dinâmicos entre diversos dispositivos (spokes) utilizando-se de um gateway convergente (hub). Um dos benefício principais do AD-VPN, é o fato do dispositivo central (hub) transmitir automaticamente as configurações de VPN e as informações dos túneis autorizados para os dispositivos que irão integrar a comunidade de servidores, este recurso facilita a inserção de novos Spokes.As funcionalidades do AD-VPN estão disponíveis apenas para VPN do tipo Star e Full-Mesh.O AD-VPN da\xa0Blockbit foi desenvolvido baseado no protocolo BGP, em virtude da sua capacidade de espelhar a rota, este protocolo é particularmente vantajoso no processo de roteamento e manutenção do estado de cada link conectado. Tal recurso possibilita a criação de túneis diretos de VPN baseados na rota mais eficiente entre os dispositivos que necessitam se comunicar.', 'Durante o processo de criação de um túnel AD-VPN, é obrigatório selecionar uma interface do tipo Tunnel (GRE) de modo que as rotas e configurações de roteamento dinâmico sejam automaticamente aplicadas. Para criar a interface adequada, cheque o capítulo Interface Túnel.Conforme exemplificado na imagem abaixo,\xa0para utilizar uma interface túnel com o AD-VPN é necessário:Que a opção “Dynamic” em “Remote Address” esteja marcada;Que a máscara seja fechada;O IP da interface TUN deve ser menor que 224.0.0.0/24. Ex. 30.0.0.1/255.255.255.255.Tunnel Options', 'Em um túnel AD-VPN o administrador deve declarar todas as redes que serão roteadas dinamicamente entre a comunidade de servidores (Hub e Spoke).À seguir, vamos analisar como configurar um túnel "Star".GeneralAbaixo analisaremos cada opção disponível no painel general:VPN IPSEC - GeneralDescription:\xa0Campo onde é determinada a descrição da VPN, que está sendo configurada;IKE version:\xa0O IKE – Internet Key Exchange é o protocolo usado para estabelecer uma associação de segurança (SA) na suíte de protocolos IPSec. O IKE se baseia no protocolo Oakley e ISAKMP, utiliza-se de uma chave de autenticação PSK ou certificados X509 e uma troca de chaves “Diffie Hellman”;', '\xa0No\xa0Blockbit UTM utilizamos a chave do tipo: “PSK (Chave pré compartilhada)”, e a troca de chaves “Diffie Hellman”. O sistema suporta as versões IKEV1 e IKEV2.', '', 'É essencial para o funcionamento correto da VPN que todas as devices desta mesma comunidade de servidores estejam configuradas para a mesma versão IKE.', 'Tunnel initialization:\xa0Determina como será a inicialização do túnel, as opções disponíveis são:Automatic: Adiciona e inicializa o Túnel;Wait: Adiciona e não inicializa o Túnel. Aguarda requisição de demanda (tráfego) por parte da outra ponta VPN;On demand: Inicializa e levanta o Túnel somente sob demanda, ou seja, quando houver tráfego de qualquer das ponta VPN.Shared Key:\xa0Caso a opção “Shared Key” esteja selecionada em “Authentication Method”, este campo estará disponível e é neste mesmo que o administrador pode definir a chave que será utilizada para configurar ambos os pontos da VPN. É essencial para o funcionamento correto da VPN que este campo seja igual entre todas as devices da comunidade de servidores.Abaixo analisaremos cada opção disponível no painel Dynamic VPN:Dynamic VPNO painel Dynamic VPN é composto pelos seguintes recursos:VPN IPSEC - Dynamic VPNType:\xa0Determina o tipo de servidor do device, se ele será utilizado pela VPN como Hub ou Spoke;Device:\xa0Determina a interface física túnel por onde a VPN irá sair.\xa0Para criar a interface adequada, vide o capítulo sobre adição de\xa0Interface Túnel.\xa0É necessário que em “Remote Address” a caixa de checagem “Dynamic” esteja marcada e em “IPv4” a máscara precisa ser fechada.\xa0Para mais informações cheque a sessão sobre\xa0Suporte AD-VPN;Port:\xa0Neste campo deve-se adicionar a porta do serviço de roteamento dinâmico da VPN, a porta determinada pode ser qualquer uma, contanto que ela esteja dentro do range 1024 até 65535. É requisito essencial para o correto funcionamento da VPN que esta porta esteja igual no Hub e nos Spokes (depende do que estiver sendo configurado);Area:\xa0Informa a área que será utilizada pela VPN, a área determinada pode ser qualquer uma, contanto que ela esteja dentro do range 1 até 65535. É requisito essencial para o correto funcionamento da VPN que esta área esteja igual no Hub e nos Spokes (depende do que estiver sendo configurado);Local IP:\xa0Determina o IP do próximo salto da VPN, basicamente estabelecendo para onde os pacotes serão encaminhados. Neste campo deve ser incluído o IP da interface física do Hub, NÃO o IP da interface túnel. É essencial para o funcionamento correto da VPN que o IP digitado neste campo esteja igual em todas as devices da comunidade de servidores;Spokes:\xa0Lista todos os Spokes ou Hubs que serão utilizados pela VPN. Isso é determinado pelo que foi selecionado no item “Type”, caso o servidor é do tipo “Hub”, deve-se informar o IP de todos os servidores Spoke, caso contrário, neste campo deve-se informar apenas o IP do dispositivo que se está sendo utilizado como “Hub”. Neste campo, deve-se adicionar o IP das interfaces túnel de cada device.Abaixo analisaremos cada opção disponível no painel network:NetworkO painel Network\xa0é composto pelos seguintes recursos:VPN IPSEC - NetworkIP Version:\xa0Informar a versão da rede que será declarada, que poder ser do tipo IPv4 ou IPv6;Local networks:\xa0Declaração dos endereços IP de rede/sub-rede local “não válida” do site VPN LOCAL. Ex.: “172.16.10.0/24”.', 'As “Classes de rede” não válida dos sites VPN [Local/Remoto], requer que estejam obrigatoriamente em uma “Classe de rede broadcast diferente”.', '', 'Redes VPN utilizando IKEv1, não suportam declaração de “Múltiplas redes”.', 'Abaixo analisaremos cada opção disponível no painel Cryptography:CryptographyO painel Cryptography\xa0é composto pelos seguintes recursos:VPN IPSEC - CryptographyPhase 1 (IKE):\xa0Baseado no protocolo ISAKMP (IKE/SA): define o agrupamento dos algoritmos e especificações técnicas de autenticação da Fase (IKE/SA) para o dispositivo VPN utilizado para estabelecer o túnel VPN:Cryptographic Algorithms;Authentication Algorithm;DH Group (Diffie Hellman).Phase 2 (ESP):\xa0O protocolo ESP fornece confidencialidade de dados (criptografia) e autenticação (integridade de dados e autenticação da origem dos dados). O ESP se baseia na utilização dos algoritmos AH (Authentication Header) e ESP (Encapsulating Security Payload).\xa0Baseado nos protocolos AH e ESP (ESP/AS): Define o agrupamento dos algoritmos e especificações técnicas de autenticação da Fase (IPSEC/SA) para o dispositivo VPN utilizado para estabelecer o túnel VPN:Cryptographic Algorithms;Authentication Algorithm;PFS Group.Abaixo analisaremos cada opção disponível no painel Advanced:AdvancedO painel Advanced\xa0é composto pelos seguintes recursos:VPN IPSEC - AdvancedIKE lifetime:\xa0Determina o tempo de vida que o protocolo (IKE ou IPSEC dependendo da fase) irá aguardar para renegociar a SA (Security Association), que especifica os algoritmos a serem utilizados, as chaves criptográficas, e os tempos de vida destas chaves. O tempo de vida deve ser determinado em segundos.\xa0O protocolo IKE é o autenticador e o negociador do IPSec;Key lifetime:\xa0Determina o tempo de validade da chave de negociação bem-sucedida. O tempo de vida deve ser determinado em segundos;Keying tries:\xa0Este é o número de vezes que os pontos VPN vão renegociar o túnel ou tentar reautenticação (re-key) depois que a chave expirar. Determina o número de tentativas para estabelecer a renegociação em cada fase de negociação do IKE/IPSec;Rekey Margin:\xa0Determina quanto tempo antes da conexão expirar os pontos VPN e inicializar a renegociação das chaves do túnel. Tempo mínimo = 5 minutos. Tempo máximo = 9 minutos.\xa0Este campo é determinado em segundos;DPD Action:\xa0O item DPD (Dead peer detection action) controla o uso do protocolo de detecção dos pontos de VPN perdidos. Onde as mensagens de notificação do protocolo IKE v1 e IKE v2 são enviados periodicamente a fim de verificar se os pontos IPSec estão respondendo, ou estão perdidos.\xa0A seleção de qualquer valor “clear”, “hold” e “reiniciar”, ativa o serviço DPD e determina a ação a ser executada em um tempo\xa0limite:A ação “Clear” fecha, ou encerra a conexão sem tomadas de medidas prévias;A ação “Hold” configura uma política estratégica que captura o tráfego e tenta renegociar a conexão sob demanda;A ação “Restart” inicia imediatamente uma tentativa de renegociação da conexão;O padrão é “None” ou nenhuma, desativa o envio automático das mensagens DPD.DPD Delay:\xa0Define o intervalo de tempo ou período, que as mensagens de troca IKE v1 e IKE v2 informativas são enviadas para os pontos VPN. Tempo padrão 30 segundos.\xa0Este campo é determinado em segundos;DPD timeout:\xa0Define o intervalo de tempo limite para o envio das mensagens, para o IKE v1 após todas as conexões para um ponto VPN serem perdidas em caso de inatividade. Tempo padrão 150 segundos.\xa0Este campo é determinado em segundos;', 'Para o IKE v2 o tempo limite de retransmissão “DPD delay” sempre se aplica.', 'Re-Auth:\xa0Esta caixa de checagem permite habilitar o processo de reautenticação. Este recurso tem como função renegociar as chaves IKE e verificar a validade das credenciais, caso esta caixa de seleção esteja desabilitada, a conexão continuará ativa mesmo caso o certificado tenha expirado;Fragmentation:\xa0Ao habilitar esta caixa de checagem, mensagens IKEv2 muito extensas são fragmentadas em um conjunto de mensagens menores, que por sua vez são encriptadas individualmente. A função deste recurso é permitir que mensagens IKEv2 sejam transportadas por dispositivos de rede que não permitem a transporte de fragmentos de IP;Compression:\xa0Esta caixa de checagem habilita o uso do protocolo IPComp para a compressão do conteúdo dos pacotes de IP em conjunto com a criptografia IPsec. Caso ambos os hosts possuam recursos o suficiente para efetuar o processo de compactação e caso o link utilizado não esteja apresentando alguma instabilidade, a comunicações entre os nós é melhorada;', 'Pacotes pequenos (por exemplo: ICMP com tamanho default), não sofrem compressão. A comunicação é feita através de um túnel IPIP, sendo necessário efetuar a liberação do objeto de serviço padrão: IPIP-ENCAPSULATION (protocolo IPv4 Encapsulation) entre os peers através de uma política de Zone-Protection.Para mais informações a respeito da compressão cheque o RFC 3173.Para mais dados de encapsulamento IP dentro de IP vide o RFC 2003.Para mais informações a respeito de fragmentação, consulte esta\xa0página.', 'NAT-T:\xa0Habilite o item NAT-T (NAT Transversal) caso um dos sites VPN estiver atrás de um servidor de tradução de endereços (NAT) “Firewall”. Este recurso habilitado garante o encapsulamento UDP (UDP/4500) e que os pacotes trafegados serão traduzidos corretamente.', 'Habilitação obrigatória somente para o IKE v1.', 'Após finalizar as configurações adequadas, clique em [] para salvar as configurações, caso contrário, clique em [] para voltar.', 'Ao finalizar, é possível\xa0validar as configurações da sua VPN\xa0através dos seguintes meios:Pela aba\xa0Live Sessions - VPN;Em\xa0Security Events - VPN;Usando os comandos de CLI abaixo:debug-vpn -t ipsec;show-vpn-conn;show-vpn-info.Para mais informações, sobre cada um destes procedimentos consulte a página de\xa0Troubleshooting das VPNs.', '', '']
